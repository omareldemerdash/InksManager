pipeline {
  agent any
  parameters {
    choice(
      name: 'TAG_TO_DEPLOY',
      choices: getGitTags(),
      description: 'Select the Git tag you want to deploy (for rollback or versioned release)'
    )
  }
  environment {
        CREDENTIALS = credentials('dockerhub')
        AWS_DEFAULT_REGION = 'us-east-1'
  }
  stages {
     stage('Checkout Code') {
      steps {
        script {
          echo "ðŸ”– Checking out tag: ${params.TAG_TO_DEPLOY}"
          checkout([$class: 'GitSCM',
            branches: [[name: "refs/tags/${params.TAG_TO_DEPLOY}"]],
            userRemoteConfigs: [[url: 'https://github.com/omareldemerdash/InksManager.git']] 
          ])
        }
      }
    }

  }
}
def getGitTags() {
  def tags = sh(script: "git ls-remote --tags  https://github.com/omareldemerdash/InksManager.git| cut -d/ -f3 | grep -v '{}' | sort -r", returnStdout: true).trim().split('\n')
  return tags.take(10).join('\n') // show latestÂ 10Â tags
}
